from os.path import join, dirname

wildcard = '{seq,[^/]+}'

def grab_output(wildcards):
    f = []
    for tool in config['tools']:
        p = join(config['output_dir'], tool, wildcards.seq + '.gff')
        f.append(p)
    return f

# input nucleotide seq file in wildcard format
INPUT = join(dirname(config['seq']), wildcard)

for tool in config['tools']:
    tool_out = join(config['output_dir'], tool, wildcard)
    tool_config = config['tools'][tool]
    include: '%s.rule' % tool

# useful snakemake cmd:
# -n (dry run) and -p (print commands) and -F which will force snakemake to rerun rules
# snakemake -n -p --rulegraph
# -l

# workdir: '/tmp'

# rule all:
#     input:
#         join(config['output_dir'], '{seq}.gff')

# rule report:
#     input:
#         '{seq}.gff'
#     output:
#         "{seq}.html"
#     run:
#         from snakemake.utils import report
#         shell('touch {output[0]}')


rule integrate:
    input:
        grab_output
    output:
        join(config['output_dir'], wildcard + '.gff')
    shell:
        'touch {output[0]}'

# ruleorder: ncRNA > tRNA > CRISPR
